@page "/add-note"
@inject IHttpClientFactory CF
@using System.ComponentModel.DataAnnotations
@using System.Data
@using System.Net.Http.Json
@rendermode InteractiveServer


<PageTitle>Home</PageTitle>

<h1>New Note</h1>

<EditForm Model="_note" OnValidSubmit="HandleSubmit" FormName="CreateNoteForm">
    
    <DataAnnotationsValidator/>
    <ValidationSummary/>
            
    <div>
        <label>Title</label>
        <InputText class="form-control " @bind-Value="_note.Title"/>
        <ValidationMessage For="@(() => _note.Title)"/>
    </div>
    
            
    <div>
        <label>Content</label>
        <InputTextArea class="form-control " rows="10" @bind-Value="_note.Content"/>
        <ValidationMessage For="@(() => _note.Content)"/>
    </div>
    
    <button type="submit">Add Note</button>
    
</EditForm>
@if (!string.IsNullOrWhiteSpace(_message))
{
    <div class="mt-3"> @_message</div>
}
@code{

    private CreateNoteDTO _note = new ();
    private string? _message;

    private async Task HandleSubmit()
    {
        var client = CF.CreateClient("NoteAppAPI");
        var res = await client.PostAsJsonAsync("api/notes", _note);

        _message = res.IsSuccessStatusCode
            ? "Note Create Successfully!"
            : $"Failed: {(int)res.StatusCode} {res.ReasonPhrase}\n{await res.Content.ReadAsStringAsync()}";

        if (res.IsSuccessStatusCode) _note = new();
    }

    public class CreateNoteDTO
    {
        [Required, MinLength(3)]
        public string Title { get; set; } = string.Empty;

        public string Content { get; set; } = string.Empty;
        
        public DateTime Created { get; set; } = DateTime.Now;

        public DateTime Modified { get; set; } = DateTime.Now;

    }
    

}
